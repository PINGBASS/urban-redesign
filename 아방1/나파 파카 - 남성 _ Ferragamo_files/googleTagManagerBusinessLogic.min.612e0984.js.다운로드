var B_GOOGLE_TAG_MANAGER=B_GOOGLE_TAG_MANAGER||{};!function(m){B_GOOGLE_TAG_MANAGER={googleTagManagerEnabled:!1,visitorType:"",visitorMail:"",init:function(){},setDataLayerCart:function(e,t,r){if("undefined"!=typeof dataLayer)if(void 0!==t&&!0===t){var a={Cart:e.recordSetCount};if(B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(a),"product--r19"==MAIN.pageTemplate||"product--r23"==MAIN.pageTemplate){var o={event:"PDPCartValue",cartValue:B_MINISHOPCART.totalProductPrice||"0.00"};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(o)}}else{var i=B_MINISHOPCART.product_map[B_MINISHOPCART.lastAddedOrRemovedOrderItemId];"remove"===r&&(i=B_MINISHOPCART.lastAddedOrRemovedOrderItem);a={Cart:e.recordSetCount,event:"cart-changed",cartAction:r,cartProductName:i.name,cartProductID:i.partNumber,cartProductPrice:i.price.split(" ")[2],cartProductSKU:i.partNumber.substring(0,6)};a=B_GOOGLE_TAG_MANAGER.setItemCategoriesR24(a),"add"==r&&(a.cartValue=B_MINISHOPCART.totalProductPrice,B_SHOPPING.selectedItemPartNumber&&""!==B_SHOPPING.selectedItemPartNumber&&(a.skuSize=B_SHOPPING.selectedItemPartNumber),i.Size&&""!==i.Size&&(a.size=i.Size),i.Width&&""!==i.Width&&(a.width=i.Width)),B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(a,"cart-changed")}},setDataLayerSearchFilterAndNumberProduct:function(t,e,r){if("undefined"!=typeof dataLayer){var o=[];if(Object.keys(t).forEach(function(a,e){t[a].forEach(function(e,t){var r=[];r.push(a),r.push(e),o.push(r)})}),void 0!==r&&!0===r){var a={Filter:JSON.stringify(o),NumberProduct:e};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(a)}else{a={Filter:JSON.stringify(o),NumberProduct:e,event:"search-filter-changed"};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(a,"search-filter-changed")}}},setDataLayerCategoryOrderBy:function(e){if("undefined"!=typeof dataLayer){var t=m.trim(m("[data-attr-id=dropdown-openBtn-inner]").first().text());if(void 0!==B_GOOGLE_TAG_MANAGER.categoryOrderByOnLoad&&!0===B_GOOGLE_TAG_MANAGER.categoryOrderByOnLoad){var r={sortBy:t};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(r),B_GOOGLE_TAG_MANAGER.categoryOrderByOnLoad=!1}else{r={sortBy:t,event:"pdc-sortby-changed"};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(r,"pdc-sortby-changed")}}},setDataLayerCategoryFilter:function(e,t,r,a){if("undefined"!=typeof dataLayer)if(0<e.length){var o=[],i=!1;for(var d in e){var n=e[d],c=[];if("sapstore"===n){i=!0;var u={StoreCode:t[d],event:"pdc-filter-changed"};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(u,"pdc-filter-changed")}else if("inventory"===n)c.push("InStock"),c.push(t[d]),o.push(c);else{var s=a[r.indexOf(n)],G=m("#facetLabel_"+n).text();c.push(s),c.push(G),o.push(c)}}if(!i){u={Filter:JSON.stringify(o),event:"pdc-filter-changed"};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(u,"pdc-filter-changed")}}else{u={StoreCode:"",Filter:"",event:"pdc-filter-changed"};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(u,"pdc-filter-changed")}},setDataLayerCategoryNumberProduct:function(){if("undefined"!=typeof dataLayer){var e={NumberProduct:m.trim(m("[data-attr-id=frg_record_results]").first().text()),event:"pdc-filter-changed"};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(e,"pdc-filter-changed")}},setDataLayerProductStoreCode:function(e){if("undefined"!=typeof dataLayer){var t={StoreCode:e,event:"pdp-reserve-store-selected"};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(t,"pdp-reserve-store-selected")}},setDataLayerCartProductQty:function(e,t){if("undefined"!=typeof dataLayer){if("undefined"==typeof datalayerProduct)for(var r in datalayerProduct=B_GOOGLE_TAG_MANAGER.fgclone(dataLayer[0].Product),datalayerProductItemsId=new Array,B_CHECKOUT.cartItemList)datalayerProductItemsId.push(B_CHECKOUT.cartItemList[r].orderItemId);for(var r in datalayerProductItemsId)if(datalayerProductItemsId[r]==t){if(0==e){datalayerProduct.splice(r,1),datalayerProductItemsId.splice(r,1);break}datalayerProduct[r].Quantity=e}var a=0;for(var r in datalayerProduct)a+=parseInt(datalayerProduct[r].Quantity);var o={Product:B_GOOGLE_TAG_MANAGER.fgclone(datalayerProduct),Cart:a,event:"cart-product-list-changed"};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(o,"cart-product-list-changed")}},fgclone:function(e){return JSON.parse(JSON.stringify(e))},setDataLayerProductID:function(e){if("undefined"!=typeof dataLayer){var t={ProductID:e,event:"pdp-size-changed"};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(t,"pdp-size-changed")}},setDataLayerCartGift:function(e,t){if("undefined"!=typeof dataLayer){var r=e?"Yes":"No";if(void 0!==t&&!0===t){var a={Gift:r};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(a)}else{a={Gift:r,event:"cart-gift-option-changed"};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(a,"cart-gift-option-changed")}}},getGiftMessage:function(t){var e=m.tcl.cartServices.getGiftMessage(B_CHECKOUT.storeId,B_CHECKOUT.orderId,!0);m.when(e).done(function(e){debug.log("------GTM: Get Gift Message------"),debug.log(e),debug.info("Got gift message"),void 0===e.errors?(m("body").data("widget"),B_GOOGLE_TAG_MANAGER.setDataLayerCartGift(!0,t)):B_GOOGLE_TAG_MANAGER.setDataLayerCartGift(!1,t)}).fail(function(e,t,r){}).always(function(){})},setDataLayerCartPickUp:function(e,t){if("undefined"!=typeof dataLayer){var r=void 0!==e?"Yes":"No",a=void 0!==e?e:"";if(void 0!==t&&!0===t){var o={PickUp:r,PickUpStore:a};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(o)}else{o={PickUp:r,PickUpStore:a,event:"cart-pickup-option-changed"};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(o,"cart-pickup-option-changed")}}},getPickUpInStore:function(e){B_CHECKOUT.findAddress("Shipping Address",!1,!1),"FERRAGAMO"===B_CHECKOUT.pickingAddress.organizationName&&B_GOOGLE_TAG_MANAGER.setDataLayerCartPickUp(B_CHECKOUT.pickingAddress.organizationUnitName,e)},setDataLayerCheckout:function(e,t){if("undefined"!=typeof dataLayer){var r=m('[name="step2_shipping_mode"]:checked').data("code-delivery"),a=m("input[name=step3_creditcard_brand]:checked").attr("data-attr-name-card");null==r&&null==a&&(r=window.sessionStorage.getItem("DeliveryMethod"),a=window.sessionStorage.getItem("CCType"));var o={Step:""+(e+2),DeliveryMethod:1<e?r:"",PaymentMethod:2<e?m('[name="step3_payment_method"]:checked').val():"",Conversion:2<e?"true":"",TotalGross:2<e?t.grandTotal:0,TotalNet:2<e?t.totalProductPrice:0,DeliveryCost:2<e?t.totalShippingCharge:0,DeliveryCostTax:2<e?t.totalShippingTax:0,SubTotalTax:2<e?t.totalSalesTax:0,Tax:2<e?COMMON.formatNumber(t.totalSalesTax)+COMMON.formatNumber(t.totalShippingTax):0};if(2<e){"undefined"==typeof datalayerProduct&&(datalayerProduct=B_GOOGLE_TAG_MANAGER.fgclone(dataLayer[0].Product));var i="",d="",n="",c="",u="",s="";for(var G in datalayerProduct)i=0==G?"'"+datalayerProduct[G].name+"'":i+",'"+datalayerProduct[G].name+"'",d=0==G?"'"+datalayerProduct[G].ProductSKU+"'":d+",'"+datalayerProduct[G].ProductSKU+"'",n=0==G?"'"+datalayerProduct[G].ProductID+"'":n+",'"+datalayerProduct[G].ProductID+"'",c=0==G?"'"+datalayerProduct[G].Price+"'":c+",'"+datalayerProduct[G].Price+"'",u=0==G?"'"+datalayerProduct[G].ProductSize+"'":u+",'"+datalayerProduct[G].ProductSize+"'",s=0==G?"'"+datalayerProduct[G]["Product Width"]+"'":s+",'"+datalayerProduct[G]["Product Width"]+"'";for(var G in t.orderItem)void 0!==datalayerProduct[G]&&(datalayerProduct[G].PriceTax=COMMON.formatNumber(t.orderItem[G].salesTax)/COMMON.formatNumber(t.orderItem[G].quantity));var p="";if(void 0!==t.promotionCode)for(var G in t.promotionCode)void 0!==t.promotionCode[G].code&&(p=0==G?t.promotionCode[G].code:p+"|"+t.promotionCode[G].code);var _=void 0!==t.totalAdjustment?t.totalAdjustment:"";o.CCType=a,o.wt_productName=i,o.wt_productSKU=d,o.wt_productId=n,o.wt_price=c,o.wt_productSize=u,o.wt_productWidth=s,o.Product=B_GOOGLE_TAG_MANAGER.fgclone(datalayerProduct),o.promoCode=p,o.promoCodeDiscount=_}o.event="checkout-step-changed",B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(o,"checkout-step-changed")}},setDataLayerClickWishList:function(){dataObj={event:"CTA wishlist"},B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(dataObj)},setDataLayerClickAddWishList:function(){dataObj={event:"Add wishlist"},B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(dataObj)},setDataLayerEnigmaRegistration:function(){dataObj={event:"generic_event",eventAction:"Mail_OK"},B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(dataObj)},pushForGtmWebtrekk:function(e,t){"undefined"!=typeof dataLayer&&(dataLayer.push(e),void 0!==t&&""!==t&&void 0!==window.webtrekk_funcs&&void 0!==window.webtrekk_funcs.dataLayerPush&&window.webtrekk_funcs.dataLayerPush(t))},setDataLayerCartR21:function(){var t={ContentType:"eCommerce",Store:COMMON.frgStoreIdentifier,StoreID:COMMON.storeId,Country:COMMON.country,Language:COMMON.localeCountry.split("_")[0],Currency:COMMON.currencyIsoFormat,Canonical_URL:window.location.protocol+"//"+window.location.hostname+window.location.pathname,OrderID:B_CHECKOUT.cart.orderId,Cart:B_CHECKOUT.cart.totalQuantity};"cart-r21"===MAIN.pageTemplate?(t.pageCategory="Cart",t.Step="1"):0<m('[data-chkt-step="email"]').length?t.pageCategory="Login":"checkout-r21"===MAIN.pageTemplate&&0===m('[data-chkt-step="email"]').length&&(t.pageCategory="Checkout",t.Step="2"),t.Product=[],_.each(B_CHECKOUT.cart.orderItem,function(e){product={},product["Product Width"]=e.widthValNotConverted,product.ProductSize=e.sizeValNotConverted,product.name=e.productInfo.name,product.ProductID=e.productInfo.partNumberChild,product.ProductSKU=e.productInfo.partNumber,product.Price=e.orderItemAmount.unitPrice,product.Quantity=e.quantity,product=B_GOOGLE_TAG_MANAGER.setPricesAndAttributesForCartAndCheckout(product,e),t.Product.push(product)}),B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(t)},setPricesAndAttributesForCartAndCheckout:function(e,t){e.season=t.productInfo.collection;var r=0,a=!1;if(_.each(t.productInfo.prices,function(e){"sale"===e.type&&"3.0"==e.precedence&&(r=e.formattedPrice,a=!0),"full"===e.type&&(fullPrice=Number.parseFloat(e.formattedPrice))}),a){var o=fullPrice-Number.parseFloat(r);e.discount=""+o,e.sale=a}return e.stock_status=!0,(!t.inventory||t.inventory&&0==Object.keys(t.inventory).length)&&(e.stock_status=!1),e},setDataLayerCartR21ProductQty:function(t,r){var a={event:"cart-product-list-changed",ecommerce:{currencyCode:COMMON.currencyIsoFormat}};a.ecommerce[t]={},a.ecommerce[t].products=[],_.each(B_CHECKOUT.cart.orderItem,function(e){e.orderItemId===r&&(product={},product.name=e.productInfo.name,product.id=e.productInfo.partNumber,product.price=e.orderItemAmount.unitPrice,product.brand=COMMON.frgStoreIdentifier,product.variant=e.sizeValNotConverted,product.quantity=1,a.ecommerce[t].products.push(product))}),"add"==t&&("undefined"!=typeof B_MINISHOPCART?a.cartValue=B_MINISHOPCART.totalProductPrice:a.cartValue=B_CHECKOUT.cart.orderAmount.totalProductPrice),B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(a,"cart-product-list-changed")},setDataLayerCartR24ProductQty:function(e,r){var a={event:e+"_to_cart",ecommerce:{currency:COMMON.currencyIsoFormat,items:[]}};_.each(B_CHECKOUT.cart.orderItem,function(e){var t={};e.orderItemId===r&&(t={item_name:e.productInfo.name,item_id:e.productInfo.partNumber,price:e.orderItemAmount.unitPrice},t=B_GOOGLE_TAG_MANAGER.setPricesAndAttributesForCartAndCheckout(t,e)),a.ecommerce.items.push(t)}),B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(a)},setDataLayerShippingR21Gift:function(e){if("undefined"!=typeof dataLayer){var t={Gift:e?"Yes":"No",event:"cart-gift-option-changed"};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(t,"cart-gift-option-changed")}},setDataLayerShippingR21PickUpInStore:function(e){if("undefined"!=typeof dataLayer){var t=void 0!==e?"Yes":"No",r=void 0!==e?e:"",a={"Order ID":B_CHECKOUT.cart.orderId,PickUp:t,event:"cart-pickup-option-changed"};"Yes"==t&&(a.PickUpStore=r,B_CHECKOUT.shippingOption="Ship to Store"),B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(a,"cart-pickup-option-changed")}},setDataLayerCheckoutR21:function(e){var t;if("undefined"!=typeof dataLayer&&("cart-r21"===MAIN.pageTemplate?t=1:0<m('[data-chkt-step="shipping"]').length?t=e?3:2:0<m('[data-chkt-step="payment"]').length?t=4:0<m('[data-chkt-step="thankyou"]').length&&(t=5),t)){!B_CHECKOUT.pickingAddress||m.isEmptyObject(B_CHECKOUT.pickingAddress)?B_CHECKOUT.shippingOption=B_CHECKOUT.cart.orderItem[0].orderItemShippingInfo.shippingModeDescr:B_CHECKOUT.shippingOption="Ship to Store";var r={Step:""+t,DeliveryMethod:2<t?B_CHECKOUT.shippingOption:"",PaymentMethod:4<t?B_CHECKOUT.cart.paymentMethod:"",Conversion:2<t?"true":"",TotalGross:COMMON.formatNumber(B_CHECKOUT.cart.orderAmount.grandTotalNotFormatted),TotalNet:COMMON.formatNumber(B_CHECKOUT.cart.orderAmount.totalProductPrice),DeliveryCost:COMMON.formatNumber(B_CHECKOUT.cart.orderAmount.totalShippingCharge),DeliveryCostTax:COMMON.formatNumber(B_CHECKOUT.cart.orderAmount.totalShippingTax),SubTotalTax:COMMON.formatNumber(B_CHECKOUT.cart.orderAmount.totalSalesTax),Tax:COMMON.formatNumber(B_CHECKOUT.cart.orderAmount.totalTax),event:"checkout-step-changed"},a=void 0!==B_CHECKOUT.cart.promotions,o=a?B_CHECKOUT.cart.promotions[0].code:"";a&&(r.promoCode=o,r.promoCodeDiscount=COMMON.formatNumber(B_CHECKOUT.cart.orderAmount.totalAdjustment)),B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(r,"checkout-step-changed")}},setDataLayerNewsletterRegistration:function(e){B_GOOGLE_TAG_MANAGER.addEmailAndPush({event:"newsletter-registration"},e)},setDataLayerNewRegistration:function(e){B_GOOGLE_TAG_MANAGER.addEmailAndPush({event:"New Registration"},e)},setDataLayerLogin:function(e){B_GOOGLE_TAG_MANAGER.addEmailAndPush({event:"login"},e)},addEmailAndPushIfLogged:function(e){"logged"===B_GOOGLE_TAG_MANAGER.visitorType?B_GOOGLE_TAG_MANAGER.addEmailAndPush(e):B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(e)},addEmailAndPush:function(t,e,r){var a=void 0!==e?e:B_GOOGLE_TAG_MANAGER.visitorMail;if(void 0===a)B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(t);else{var o="",i=new TextEncoder("utf-8").encode(a),d=crypto.subtle.digest("SHA-256",i);m.when(d).done(function(e){o=COMMON.hex(e),t.email_sha256=o,B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(t,r)})}},setDataLayerCategoryFilterR24:function(e,t){if("undefined"!=typeof dataLayer){var r={event:"PLP-filter",Level1:e,Level2:t||"none"};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(r)}},setDataLayerProductCardR24:function(e,t){if("undefined"!=typeof dataLayer&&void 0!==e)for(var r=0;r<B_CATEGORY.lastCall.response.products.length;r++)if(B_CATEGORY.lastCall.response.products[r].uniqueID===e){var a=B_CATEGORY.lastCall.response.products[r],o={item_name:a.name,item_id:a.partNumber,price:a.prices[0].formattedPrice,season:a.collection,index:1};o=B_GOOGLE_TAG_MANAGER.setItemCategoriesR24(o),o=B_GOOGLE_TAG_MANAGER.setPriceSaleR24(o,a);var i={event:"select_item",ecommerce:{item_list_name:t,currency:COMMON.currencyIsoFormat,items:[o]}};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(i);break}},setDataLayerAddToWishlistR24:function(e){if("undefined"!=typeof dataLayer)for(var t=0;t<B_CATEGORY.lastCall.response.products.length;t++)if(B_CATEGORY.lastCall.response.products[t].uniqueID===e){var r=B_CATEGORY.lastCall.response.products[t],a={event:"add_to_wishlist",ecommerce:{currency:COMMON.currencyIsoFormat,items:[{item_name:r.name,item_id:r.partNumber,price:r.prices[0].formattedPrice}]}};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(a);break}},setDataLayerProductPageAddToWishlistR24:function(e){if("undefined"!=typeof dataLayer){var t=B_SHOPPING.productDetail[e].productDetail,r={event:"add_to_wishlist",ecommerce:{currency:COMMON.currencyIsoFormat,items:[{item_name:t.name,item_id:t.partNumber,price:t.prices[0].formattedPrice}]}};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(r)}},setDataLayerClickFindInBoutiqueR24:function(){if("undefined"!=typeof dataLayer){B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk({event:"find_in_store-1"})}},setDataLayerClickReserveInStoreR24:function(e){if("undefined"!=typeof dataLayer){var t={event:"find_in_store-2",storeId:e};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(t)}},setDataLayerClickSendFormReserveInStoreR24:function(e){if("undefined"!=typeof dataLayer){var t={event:"find_in_store-3",storeId:e};B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(t)}},setDataLayerClickGreyAreaMinicartR24:function(){if("undefined"!=typeof dataLayer){B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk({event:"minicart-close-greyArea"})}},setDataLayerClickCloseBtnMinicartR24:function(){if("undefined"!=typeof dataLayer){B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk({event:"minicart-close-xButton"})}},productImpressions:function(e,a){if("undefined"!=typeof dataLayer){var t=B_GOOGLE_TAG_MANAGER.chunkProduct(e,10),o=0;_.each(t,function(e){var r={event:"view_item_list",ecommerce:{item_list_name:a,currency:COMMON.currencyIsoFormat,items:[]}};_.each(e,function(e){var t={item_name:e.name,item_id:"wishlist"===a?e.partNumber.substring(0,6):e.partNumber,price:"wishlist"===a?e.price:"recently_viewed"===a?e.price:e.prices[0].formattedPrice,index:o+=1};"recently_viewed"!==a&&(t=B_GOOGLE_TAG_MANAGER.setItemCategoriesR24(t)),t=B_GOOGLE_TAG_MANAGER.setPriceSaleR24(t,e),"category"===a&&(r.ecommerce.item_list_name=t.item_list_name),r.ecommerce.items.push(t)}),B_GOOGLE_TAG_MANAGER.pushForGtmWebtrekk(r)})}},chunkProduct:function(e,t){if(null==t||t<1)return[];for(var r=[],a=0,o=e.length;a<o;)r.push(Array.prototype.slice.call(e,a,a+=t));return r},setItemCategoriesR24:function(e){return void 0!==e&&(window.itemCategory&&""!==window.itemCategory&&(e.item_category=window.itemCategory,e.item_list_name=window.itemCategory+" / "),window.itemCategory2&&""!==window.itemCategory2&&(e.item_category2=window.itemCategory2,e.item_list_name+=window.itemCategory2),window.itemCategory3&&""!==window.itemCategory3&&(e.item_category3=window.itemCategory3,e.item_list_name+=" / "+window.itemCategory3),window.itemCategory4&&""!==window.itemCategory4&&(e.item_category4=window.itemCategory4,e.item_list_name+=" / "+window.itemCategory4)),e},setPriceSaleR24:function(r,e){if(void 0!==r){var t=0,a=0;e.prices&&(_.each(e.prices,function(e,t){"sale"===e.type&&"3.0"==e.precedence&&(r.price=e.formattedPrice,r.discount=e.discountPercentage,r.sale=!0),"full"===e.type&&(a=Number.parseFloat(e.formattedPrice))}),r.sale&&(t=a-Number.parseFloat(r.price),r.discount=""+t))}return r}}}(jQuery);
//# sourceMappingURL=googleTagManagerBusinessLogic.min.612e0984.js.map